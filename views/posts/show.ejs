<% layout('layouts/boilerplate') %>
    <div class="row px-4 mx-1">
        <div class="col-md-6">
            <div class="card">
                <div class="card-body">
                    <h5 class="card-title">
                        <%=post.question%>
                    </h5>
                    <div class="text-muted my-3">
                        <a href="/"><i class="fas fa-pen fa-1x"></i></a>
                    </div>
                </div>
                <img src="<%= post.image %> " class="card-img-top" alt="...">
                <div class="card-body mb-3">

                    <h6 class="card-subtitle mb-2 text-muted">
                        <%= post.subject %>
                    </h6>
                    <p class="card-text">
                        <%= post.body %>
                    </p>
                    <h6 class="text-success">
                        By <%= post.author.username %>
                    </h6>
                </div>
                <ul class="list-group list-group-flush mb-3">
                    <button class="vote bg-success fs-4"><i class="fas fa-arrow-up"></i>
                        <%= post.upVotes %>
                    </button>
                    <button class="vote bg-primary fs-4"><i class="fas fa-arrow-down"> </i>
                        <%= post.downVotes %>
                            </li>
                </ul>
                <% if(currentUser && post.author.equals(currentUser._id)) {%>
                    <div class="card-body mb-3">
                        <form class="d-inline" method="POST" action="/posts/<%=post._id%>?_method=DELETE">
                            <button class="btn btn-danger">Delete</button>
                        </form>
                        <a href="/posts/<%=post._id%>/edit" class="card-link btn btn-dark">Edit You Question</a>
                    </div>
                    <% } %>
            </div>
        </div>
        <div class="col-md-6">
            <div class="mb-3">
                <% if(currentUser){ %>
                    <h1 class="display-3 text-center">Comments</h1>
                    <form class="needs-validation" novalidate method="POST" action="/posts/<%=post._id%>/comments">
                        <div class="mb-3">
                            <label class="form-label display-6" for="body">Leave a Comment</label>
                            <br>
                            <textarea class="form-control" type="text" name="comment[body]" id="body"
                                placeholder="Write a Comment" rows="5" required></textarea>
                            <div class="valid-feedback">
                                Looks Good!
                            </div>
                            <div class="invalid-feedback">
                                Write Something
                            </div>
                        </div>
                        <button class="btn btn-primary">Send</button>
                    </form>
                    <% } %>
            </div>
            <% for (let comment of post.comments ){ %>
                <div class="card mb-3">
                    <div class="card-body">
                        <h5 class="mb-3">Comment: <p class="fw-light">
                                <%= comment.body %>
                            </p>
                            <h6 class="card-subtitle mb-2 text-success">
                                By <%= comment.author.username %>
                            </h6>
                        </h5>
                        <% if(currentUser && comment.author.equals(currentUser._id)){%>
                            <i id="like" class="fas fa-thumbs-up fa-2x my-3"></i>
                            <i id="dislike" class="fas fa-thumbs-down fa-2x m-3"></i>
                            <form method="POST"
                                action="/posts/<%= post._id %>/comments/<%= comment._id%>?_method=DELETE">
                                <button class="btn btn-sm btn-danger">Delete</button>
                            </form>
                            <% } %>
                                <h6 class="card-subtitle mb-2 text-muted">
                                    <%= comment.createdAt %>
                                </h6>
                    </div>
                </div>
                <% } %>
        </div>
    </div>


    <script>
        const l = document.querySelectorAll('#like')
        const likes = Array.from(l)
        likes.forEach(function (like) {
            like.classList.add('text-primary')
        })

        const d = document.querySelectorAll('#dislike')
        const dislikes = Array.from(d)
        dislikes.forEach(function (dislike) {
            dislike.classList.add('text-primary')
        })
    </script>